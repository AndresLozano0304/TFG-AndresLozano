<div id="listadoHorarios"></div>
<br>
<div class="row">
    <div class="col">
        <button class="btn btn-primary" id="nuevoHorario"><span class='far fa-calendar-alt'></span>  Nuevo Horario</button>
    </div>
    <div class="col-4">
        <button class="btn btn-danger" id="creaPdf"><span class='fas fa-print'></span>  Imprimir/Exportar </button> 
        <button class="btn btn-success" id="creaExcel"><span class='fas fa-file-excel'></span>  Crear excel</button> 
    </div>
</div>

<script>
    //FUNCIONES--------------------------------------------------------------------------------------
   

    //DESGLOSE PARTES ----------------------------------------------------
    var table = new Tabulator("#listadoHorarios", {
      persistence:true,
      ajaxURL: "back/servidor.php", //ajax URL
      dataLoaderLoading: "Un momento!",
      progressiveLoad:"scroll",
      placeholder: "Un momento, por favor",
      ajaxConfig: "POST", //ajax HTTP request type
      ajaxParams: { listadoHorarios: "ok" },
      height: "700px",
      width: "100%",
      layout: "fitColumns",
      persistence: {
        sort: true, //persist sort
      },
      initialSort: [
        { column: "USUARIO", dir: "asc" }, //sort by this first

      ],
      rowClick:function(e,row){
        
      },
      columns: [
        {
          title: "Nº", field: "ID", width: 50, headerFilter: "input",
        },
        {
          title: "Nº", field: "REF", width: 250, headerFilter: "input",
        },
        {
          title: "DIAS SEMANA 1", field: "DS1"
        },
        {
          title: "HORA INICIO", field: "HENT11", 
          formatter: "datetime", formatterParams: {
            inputFormat: "HH:mm:ss",
            outputFormat: "HH:mm:ss",
          }
        },
        {
          title: "HORA SALIDA", field: "HSAL11", 
          formatter: "datetime", formatterParams: {
            inputFormat: "HH:mm:ss",
            outputFormat: "HH:mm:ss",
          }
        },
        {
          title: "HORA INICIO", field: "HENT12", 
          formatter: "datetime", formatterParams: {
            inputFormat: "HH:mm:ss",
            outputFormat: "HH:mm:ss",
          }
        },
        {
          title: "HORA SALIDA", field: "HSAL12", 
          formatter: "datetime", formatterParams: {
            inputFormat: "HH:mm:ss",
            outputFormat: "HH:mm:ss",
          }
        },
        {
          title: "DIAS SEMANA 2", field: "DS2", headerFilter: "input"
        },
        {
          title: "HORA INICIO", field: "HENT21", 
          formatter: "datetime", formatterParams: {
            inputFormat: "HH:mm:ss",
            outputFormat: "HH:mm:ss",
          }
        },
        {
          title: "HORA SALIDA", field: "HSAL21", 
          formatter: "datetime", formatterParams: {
            inputFormat: "HH:mm:ss",
            outputFormat: "HH:mm:ss",
          }
        },
        {
          title: "HORA INICIO", field: "HENT22", 
          formatter: "datetime", formatterParams: {
            inputFormat: "HH:mm:ss",
            outputFormat: "HH:mm:ss",
          }
        },
        {
          title: "HORA SALIDA", field: "HSAL22", 
          formatter: "datetime", formatterParams: {
            inputFormat: "HH:mm:ss",
            outputFormat: "HH:mm:ss",
          }
        }
      ],
    });

    $("#creaPdf").click(function(){
      console.log("crearPDF");
      cuerpo = table.getHtml();
      cabecera = "<!DOCTYPE html><html lang='es'><head><meta charset='UTF-8'><meta http-equiv='X-UA-Compatible' content='IE=edge'><meta name='viewport' content='width=device-width, initial-scale=1.0'><title>Listado</title>"+
      "</head><style>.tabulator-print-table{width: 100%;border-style: solid;}.tabulator-print-table-row{border-style: solid;text-align: center;}</style><body>";
      pie = "</body></html>";
      salidaHtml = cabecera+cuerpo+pie;
      var x=window.open();
      x.document.open();
      x.document.write(salidaHtml);
      x.print()
      x.document.close();
    });

    $("#creaExcel").click(function(){
      console.log("crearExcel");
      table.download("xlsx", "partes.xlsx")
    });

    $("#nuevoHorario").click(function(){
      $("#tituloModal").html("<h5>NUEVO HORARIO</h5>");
      $("#cuerpoModal").load("inc/horarioFicha.html",function(){
        $("#accion").val("nuevo");
        $("#modificarHorario").hide();
      });
      $("#modalDiv").modal("show");
    });
</script>